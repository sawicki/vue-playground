<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Age & Days Since Birth (Vue 3 - Options API)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg1: #eef3ff;
        --bg2: #f9fcff;
        --ink: #1e2a32;
        --muted: #546e7a;
        --accent: #3f51b5;
        --card: #fff;
        --ring: rgba(63, 81, 181, 0.25);
      }
      html,
      body {
        height: 100%;
        margin: 0;
        background: linear-gradient(180deg, var(--bg1), var(--bg2));
        color: var(--ink);
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
          Arial, "Apple Color Emoji", "Segoe UI Emoji";
      }
      .wrap {
        min-height: 100%;
        display: grid;
        place-items: center;
        padding: 2rem;
      }
      .card {
        width: 100%;
        max-width: 860px;
        background: var(--card);
        border: 1px solid rgba(0, 0, 0, 0.06);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
        border-radius: 20px;
        padding: 1.5rem;
      }
      h1 {
        margin: 0 0 0.25rem 0;
        font-size: clamp(1.6rem, 2vw+1rem, 2.2rem);
        color: var(--accent);
        letter-spacing: 0.2px;
      }
      .sub {
        color: var(--muted);
        margin-bottom: 1.25rem;
      }
      .grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      @media (min-width: 720px) {
        .grid {
          grid-template-columns: 1.2fr 1fr;
        }
      }
      .panel {
        border: 1px solid rgba(0, 0, 0, 0.06);
        border-radius: 16px;
        padding: 1rem;
        background: #fff;
      }
      .field {
        display: grid;
        gap: 0.25rem;
        margin-bottom: 0.75rem;
      }
      .label {
        font-weight: 600;
        font-size: 0.95rem;
      }
      .textline {
        padding: 0.65rem 0.75rem;
        border: 1px solid rgba(0, 0, 0, 0.15);
        border-radius: 12px;
        background: #fff;
      }
      .note {
        font-size: 0.9rem;
        color: var(--muted);
      }
      .stat {
        display: grid;
        gap: 0.25rem;
        padding: 0.75rem 0.25rem;
        border-bottom: 1px dashed rgba(0, 0, 0, 0.08);
      }
      .stat:last-child {
        border-bottom: 0;
      }
      .value {
        font-size: clamp(1.25rem, 1.2vw+1rem, 1.75rem);
        font-weight: 700;
        letter-spacing: 0.2px;
      }
      .mono {
        font-variant-numeric: tabular-nums;
      }
      .footer {
        margin-top: 1rem;
        font-size: 0.9rem;
        color: var(--muted);
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }
      code {
        background: #f4f6fb;
        padding: 0.1rem 0.35rem;
        border-radius: 6px;
        border: 1px solid rgba(0, 0, 0, 0.06);
        font-family: ui-monospace, Menlo, Consolas, monospace;
        font-size: 0.92em;
      }
    </style>
  </head>
  <body>
    <div id="app" class="wrap">
      <main class="card">
        <header>
          <h1>Age & Days Since Birth</h1>
          <div class="sub">
            Vue 3 (Options API) · leap-year aware · live updating
          </div>
        </header>

        <section class="grid">
          <!-- Left panel: fixed baseline + now -->
          <section class="panel">
            <div class="field">
              <div class="label">Baseline (fixed)</div>
              <div class="textline mono">{{ formattedDob }}</div>
            </div>

            <div class="field">
              <div class="label">As of</div>
              <div class="textline mono">{{ formattedNow }}</div>
              <div class="note">
                “Days since birth” uses UTC midnights to avoid DST issues.
                “Years (fraction)” uses the exact birthday-to-birthday span
                (365/366).
              </div>
            </div>
          </section>

          <!-- Right panel: results -->
          <section class="panel">
            <div class="stat">
              <div class="label">Days Since Birth</div>
              <div class="value mono">
                {{ daysSinceBirth.toLocaleString() }}
              </div>
            </div>
            <div class="stat">
              <div class="label">Age (Years, fractional)</div>
              <div class="value mono">{{ ageYearsFractional.toFixed(9) }}</div>
            </div>
            <div class="stat">
              <div class="label">Age (Years • Months • Days)</div>
              <div class="value mono">
                {{ ymdBreakdown.y }}y · {{ ymdBreakdown.m }}m · {{
                ymdBreakdown.d }}d
              </div>
            </div>
          </section>
        </section>

        <section class="footer">
          <div>Intended version: Vue <code>3.4.x</code> (Options API, CDN)</div>
          <div>Update interval: <code>1000 ms</code></div>
        </section>
      </main>
    </div>

    <!-- Vue -->
    <script
      src="https://cdn.jsdelivr.net/npm/vue@3.4.38/dist/vue.global.prod.js"
      defer
    ></script>

    <!-- App -->
    <script defer>
      // Maggie’s fixed baseline in LOCAL time:
      const DEFAULT_DOB = "2022-11-12T19:46:00";

      function isLeapYear(y) {
        return y % 4 === 0 && (y % 100 !== 0 || y % 400 === 0);
      }
      function dateLocalYMD(y, m, d) {
        return new Date(y, m - 1, d);
      }
      function dateUtcMidnight(y, m, d) {
        return new Date(Date.UTC(y, m - 1, d));
      }
      function wholeDaysBetween(d1, d2) {
        const MS = 86_400_000;
        const u1 = Date.UTC(
          d1.getUTCFullYear(),
          d1.getUTCMonth(),
          d1.getUTCDate()
        );
        const u2 = Date.UTC(
          d2.getUTCFullYear(),
          d2.getUTCMonth(),
          d2.getUTCDate()
        );
        return Math.floor((u2 - u1) / MS);
      }
      function addYearsBirthAware(birthDate, n) {
        const y = birthDate.getFullYear() + n,
          m = birthDate.getMonth() + 1,
          d = birthDate.getDate();
        if (m === 2 && d === 29 && !isLeapYear(y))
          return dateLocalYMD(y, 2, 28);
        return dateLocalYMD(y, m, d);
      }
      function wholeYearsElapsed(birthDate, asOf) {
        let years = asOf.getFullYear() - birthDate.getFullYear();
        const thisAnniv = addYearsBirthAware(birthDate, years);
        if (asOf < thisAnniv) years--;
        return years;
      }
      function birthdayWindow(birthDate, asOf) {
        const yearsCompleted = wholeYearsElapsed(birthDate, asOf);
        const lastBirthday = addYearsBirthAware(birthDate, yearsCompleted);
        const nextBirthday = addYearsBirthAware(birthDate, yearsCompleted + 1);
        return { yearsCompleted, lastBirthday, nextBirthday };
      }
      function fractionalYears(birthDate, asOf) {
        const { yearsCompleted, lastBirthday, nextBirthday } = birthdayWindow(
          birthDate,
          asOf
        );
        const num = asOf - lastBirthday,
          den = nextBirthday - lastBirthday;
        return yearsCompleted + (den > 0 ? num / den : 0);
      }
      function yearsMonthsDays(birthDate, asOf) {
        let y = wholeYearsElapsed(birthDate, asOf);
        let anchor = addYearsBirthAware(birthDate, y);
        let m = 0;
        while (true) {
          const next = new Date(
            anchor.getFullYear(),
            anchor.getMonth() + 1,
            anchor.getDate()
          );
          if (next > asOf) break;
          anchor = next;
          m++;
        }
        const d = wholeDaysBetween(
          dateUtcMidnight(
            anchor.getFullYear(),
            anchor.getMonth() + 1,
            anchor.getDate()
          ),
          dateUtcMidnight(
            asOf.getFullYear(),
            asOf.getMonth() + 1,
            asOf.getDate()
          )
        );
        return { y, m, d };
      }
      function formatLocal(dt) {
        const pad = (n) => String(n).padStart(2, "0");
        return `${dt.getFullYear()}-${pad(dt.getMonth() + 1)}-${pad(
          dt.getDate()
        )} ${pad(dt.getHours())}:${pad(dt.getMinutes())}:${pad(
          dt.getSeconds()
        )}`;
      }

      const App = {
        data() {
          return { dob: new Date(DEFAULT_DOB), now: new Date(), timer: null };
        },
        mounted() {
          this.timer = setInterval(() => {
            this.now = new Date();
          }, 1000);
        },
        beforeUnmount() {
          if (this.timer) clearInterval(this.timer);
        },
        computed: {
          formattedDob() {
            return formatLocal(this.dob);
          },
          formattedNow() {
            return formatLocal(this.now);
          },
          daysSinceBirth() {
            const bUTC = dateUtcMidnight(
              this.dob.getFullYear(),
              this.dob.getMonth() + 1,
              this.dob.getDate()
            );
            const nUTC = dateUtcMidnight(
              this.now.getFullYear(),
              this.now.getMonth() + 1,
              this.now.getDate()
            );
            return wholeDaysBetween(bUTC, nUTC);
          },
          ageYearsFractional() {
            return fractionalYears(this.dob, this.now);
          },
          ymdBreakdown() {
            return yearsMonthsDays(this.dob, this.now);
          },
        },
      };

      (function mountVue() {
        const boot = () => Vue.createApp(App).mount("#app");
        if (window.Vue) boot();
        else {
          const s = document.createElement("script");
          s.src = "https://unpkg.com/vue@3.4.38/dist/vue.global.prod.js";
          s.onload = boot;
          document.head.appendChild(s);
        }
      })();
    </script>
  </body>
</html>
